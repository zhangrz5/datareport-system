# 数据采集系统监控管理界面使用说明

## 功能概述

监控管理界面用于实时查看系统运行的各类记录数据，包括：

1. **数据同步记录** (SyncRecord) - 数据获取截止时间
2. **数据上报记录** (DataReportRecord) - 数据获取记录
3. **文件上传记录** (FileUploadRecord) - 文件上传记录
4. **通知下载记录** (NoticeDownloadRecord) - 接收下发公告请求下载记录
5. **推送日志记录** (PushLogRecord) - 数据推送日志记录

## 访问地址

启动应用后，访问以下地址：

```
http://localhost:8080/monitor/index
```

## 界面功能

### 1. 统计卡片

页面顶部显示5个统计卡片，实时展示各类记录的总数和成功数：

- **数据同步记录**: 显示总记录数和成功同步次数
- **数据上报记录**: 显示总记录数和成功上报次数
- **文件上传记录**: 显示总记录数和成功上传次数
- **通知下载记录**: 显示总记录数和成功下载次数
- **推送日志记录**: 显示总记录数和成功推送次数

**自动刷新**: 统计数据每30秒自动刷新一次

### 2. 数据表格标签页

#### 2.1 同步记录表格

显示字段：
- ID
- 表名
- 同步截止时间
- 同步数量
- 状态 (成功/失败)
- 创建时间
- 备注

#### 2.2 数据上报记录表格

显示字段：
- ID
- 上报数量
- 上报状态 (已上报/未上报)
- 创建时间
- 更新时间
- 备注
- 详情 (点击查看完整上报详情 JSON)

#### 2.3 文件上传记录表格

显示字段：
- ID
- 文件名
- 业务类型
- 文件大小(字节)
- 状态 (成功/失败/处理中)
- 创建时间
- 响应消息

#### 2.4 通知下载记录表格

显示字段：
- ID
- 文件名
- 通知类型
- 文件大小
- 状态 (成功/失败/无文件/下载中)
- 耗时(ms)
- 请求时间
- 响应消息

#### 2.5 推送日志记录表格

显示字段：
- ID
- 开始日期
- 结束日期
- 状态 (成功/失败/请求中)
- 耗时(ms)
- 请求时间
- 错误信息
- JSON响应 (点击查看完整响应 JSON)

### 3. 表格功能

所有表格支持：
- **分页**: 每页显示 10/20/50/100 条记录
- **排序**: 点击列头进行排序（部分列支持）
- **查看详情**: 点击"查看详情"或"查看JSON"按钮查看完整内容

### 4. 状态标识

- 🟢 **绿色** - 成功
- 🔴 **红色** - 失败
- 🟡 **黄色** - 待处理/进行中

## 技术实现

### 后端

- **Controller**: `MonitorController.java`
  - 路径: `/monitor/index` - 返回 HTML 页面
  - API: `/monitor/syncRecords` - 获取同步记录
  - API: `/monitor/dataReportRecords` - 获取数据上报记录
  - API: `/monitor/fileUploadRecords` - 获取文件上传记录
  - API: `/monitor/noticeDownloadRecords` - 获取通知下载记录
  - API: `/monitor/pushLogRecords` - 获取推送日志记录
  - API: `/monitor/statistics` - 获取统计数据

### 前端

- **模板引擎**: Thymeleaf
- **UI 框架**: Layui 2.8.18
- **特性**:
  - 响应式布局
  - 自动分页
  - 实时统计数据刷新
  - JSON 详情弹窗展示

## 依赖项

已添加到 `pom.xml`:

```xml
<!-- Spring Boot Thymeleaf -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-thymeleaf</artifactId>
</dependency>
```

## 文件清单

1. **Controller**: `src/main/java/com/company/datareport/controller/MonitorController.java`
2. **HTML 模板**: `src/main/resources/templates/monitor.html`
3. **依赖配置**: `pom.xml` (已添加 Thymeleaf)

## 注意事项

1. 确保应用启动后，所有 Mapper 已正确注入
2. 数据库表必须已创建（参见 `schema-interface-dm.sql`）
3. 如需修改端口，请在 `application.yml` 中配置
4. CDN 资源来自 jsdelivr，确保网络连接正常

## 自定义扩展

### 修改刷新间隔

在 `monitor.html` 中修改：

```javascript
// 每30秒刷新统计数据
setInterval(loadStatistics, 30000); // 改为你需要的毫秒数
```

### 修改每页记录数

在表格配置中修改：

```javascript
limit: 10,  // 默认每页显示数
limits: [10, 20, 50, 100],  // 可选每页显示数
```

### 添加新的表格列

在对应的 `cols` 配置中添加新列：

```javascript
{field: '字段名', title: '列标题', width: 120}
```

## 故障排查

### 1. 页面404

- 检查 Thymeleaf 依赖是否已添加
- 确认 `monitor.html` 在 `src/main/resources/templates/` 目录下
- 重新编译项目

### 2. 数据不显示

- 检查数据库连接是否正常
- 确认数据表是否已创建
- 查看浏览器控制台是否有 API 错误

### 3. 样式显示异常

- 检查网络连接，CDN 资源是否可访问
- 可考虑下载 Layui 到本地使用

## 更新日志

### v1.0.0 (2025-12-02)
- ✅ 创建监控管理界面
- ✅ 实现5个数据表格展示
- ✅ 添加实时统计卡片
- ✅ 支持分页和排序
- ✅ JSON 详情弹窗查看
- ✅ 自动刷新统计数据
